{{- if .Values.enclave.enabled }}
{{- $backendName := include "cdp.backend.fullname" . }}
{{- $enclaveName := include "cdp.enclave.fullname" . }}
{{- $dataserviceName := include "cdp.dataservice.fullname" . }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $enclaveName }}-config
  labels:
    {{- include "cdp.enclave.labels" . | nindent 4 }}
data:
  ENCLAVE_ENDPOINT: "http://{{ $enclaveName }}:{{ .Values.enclave.service.port }}/v1"
  ENCLAVE_SCRIPTS_AUDITORY: "{{ .Values.enclave.scripts.auditory }}"
  ENCLAVE_SCRIPTS_DATALAB: "{{ .Values.enclave.scripts.datalab }}"
  ENCLAVE_SCRIPTS_SEGMENT: "{{ .Values.enclave.scripts.segment }}"
  ENCLAVE_SCRIPTS_SEGMENT_CRITERIES: "{{ .Values.enclave.scripts.segmentCriteries }}"
  ENCLAVE_SCRIPTS_STATISTIC: "{{ .Values.enclave.scripts.statistics }}"
  CONFIG_FILE: "/opt/enclave/config/local.json"
  PROVIDE_NAME: "{{ .Values.backend.configs.providerName }}"
  SERVER_PORT: "{{ .Values.enclave.configs.listenPort }}"
  TMP_DIR: "/tmp"
  CH_TYPE: "real"
  CH_HOST: "{{ .Values.backend.configs.clickhouseHost }}"
  CH_PORT: "{{ .Values.backend.configs.clickhousePort }}"
  CH_DATABASE_NAME: "{{ .Values.backend.configs.clickhouseDb }}"
  SERVICES_HOST: "localhost"
  SERVICES_PORT: "8322"
  DMP_BASE_URL: "http://{{ $backendName }}:{{ .Values.backend.service.api.port }}"
  DATASERVICE_BASE_URL: "http://{{ $dataserviceName}}:{{ .Values.dataservice.service.port }}"
{{- end }}
