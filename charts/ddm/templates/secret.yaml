{{- $name := include "ddm.fullname" . -}}

apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}-secrets
  labels:
    {{- include "ddm.labels" . | nindent 4 }}
type: Opaque
stringData:
  wallet.yaml: |
    {{- .Values.wallet | toYaml | nindent 4 }}
  config.yaml: |
    server:
      bind_addr: "{{ .Values.config.server.bindAddr }}:{{ .Values.server.service.port }}"
      count_traffic: {{ .Values.config.server.countTraffic }}

    manager_server:
      bind_addr: "{{ .Values.config.manager.bindAddr }}:{{ .Values.manager.service.port }}"
      enabled: true

    tmp_storage:
      base_dir: {{ .Values.config.tmpPath }}

    data_cache_factory:
      type: disk
      params:
        base_dir: {{ .Values.config.dataCacheFactory.params.baseDir }}

    ecosystem:
      type: file
      params:
        config_file: {{ .Values.config.configsPath }}/ecosystem.yaml

    session_manager:
      type: event_emitting
      params:
        inner:
          type: memory
          params: {}

    clickhouse_instances:
      {{- .Values.config.clickhouseInstances | toYaml | nindent 6 }}

    wallet:
      type: file
      params:
        file_path: {{ .Values.config.configsPath }}/wallet.yaml

    event_exporters:
      {{- .Values.config.eventExporters | toYaml | nindent 6 }}

    task_executors:
      {{- .Values.config.taskExecutors | toYaml | nindent 6 }}

  ecosystem.yaml: |
    {{- .Values.ecosystem | toYaml | nindent 4 }}
